// Casino Database Schema
// SQLite with Prisma ORM

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // Hashed with bcrypt
  balance   Float    @default(1000.0) // Initial balance
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastBonusSpin DateTime?
  
  transactions  Transaction[]
  gameHistories GameHistory[]
  bonusSpins    BonusSpin[]
}

model Transaction {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amount    Float
  type      String   // "bet", "win", "bonus", "deposit"
  gameType  String?  // "slots", "roulette", "blackjack", "wheel"
  createdAt DateTime @default(now())
  
  @@index([userId])
}

model GameHistory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  gameType  String   // "slots", "roulette", "blackjack"
  betAmount Float
  result    String   // JSON string of game result
  payout    Float
  createdAt DateTime @default(now())
  
  @@index([userId])
}

model BonusSpin {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reward    Float
  createdAt DateTime @default(now())
  
  @@index([userId])
}

model ActiveGame {
  id        String   @id @default(cuid())
  userId    String
  gameType  String   // "blackjack"
  state     String   // JSON: { deck: [], playerHand: [], dealerHand: [], status: "playing" }
  betAmount Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}